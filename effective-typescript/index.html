<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Effective TypeScript | notebook</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/notebook/assets/css/0.styles.cc688538.css" as="style"><link rel="preload" href="/notebook/assets/js/app.e017193e.js" as="script"><link rel="preload" href="/notebook/assets/js/2.ddaab4c9.js" as="script"><link rel="preload" href="/notebook/assets/js/23.23a0fe48.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.6dff1561.js"><link rel="prefetch" href="/notebook/assets/js/11.2bbbed67.js"><link rel="prefetch" href="/notebook/assets/js/12.25aeff3d.js"><link rel="prefetch" href="/notebook/assets/js/13.145010e2.js"><link rel="prefetch" href="/notebook/assets/js/14.f76f2970.js"><link rel="prefetch" href="/notebook/assets/js/15.28f2e0f4.js"><link rel="prefetch" href="/notebook/assets/js/16.e75afda6.js"><link rel="prefetch" href="/notebook/assets/js/17.378ec3d9.js"><link rel="prefetch" href="/notebook/assets/js/18.cf6e3bb1.js"><link rel="prefetch" href="/notebook/assets/js/19.0001367c.js"><link rel="prefetch" href="/notebook/assets/js/20.b5c862ab.js"><link rel="prefetch" href="/notebook/assets/js/21.ec1838c6.js"><link rel="prefetch" href="/notebook/assets/js/22.c838bdfa.js"><link rel="prefetch" href="/notebook/assets/js/24.53c9a12d.js"><link rel="prefetch" href="/notebook/assets/js/25.e35383e3.js"><link rel="prefetch" href="/notebook/assets/js/26.f25f19c0.js"><link rel="prefetch" href="/notebook/assets/js/27.e8e55f17.js"><link rel="prefetch" href="/notebook/assets/js/28.d9fdcd5b.js"><link rel="prefetch" href="/notebook/assets/js/29.d90937d7.js"><link rel="prefetch" href="/notebook/assets/js/3.fcf37582.js"><link rel="prefetch" href="/notebook/assets/js/30.ddff32f2.js"><link rel="prefetch" href="/notebook/assets/js/31.b95da749.js"><link rel="prefetch" href="/notebook/assets/js/32.f950610a.js"><link rel="prefetch" href="/notebook/assets/js/33.ec3a8191.js"><link rel="prefetch" href="/notebook/assets/js/34.80a93e01.js"><link rel="prefetch" href="/notebook/assets/js/35.73c931e6.js"><link rel="prefetch" href="/notebook/assets/js/36.e1df5f1c.js"><link rel="prefetch" href="/notebook/assets/js/37.a9689bca.js"><link rel="prefetch" href="/notebook/assets/js/38.6277ce68.js"><link rel="prefetch" href="/notebook/assets/js/39.947e3c8d.js"><link rel="prefetch" href="/notebook/assets/js/4.7d5f245c.js"><link rel="prefetch" href="/notebook/assets/js/40.5548316e.js"><link rel="prefetch" href="/notebook/assets/js/41.79060069.js"><link rel="prefetch" href="/notebook/assets/js/42.541642ea.js"><link rel="prefetch" href="/notebook/assets/js/43.119f7ebf.js"><link rel="prefetch" href="/notebook/assets/js/44.ae346a3f.js"><link rel="prefetch" href="/notebook/assets/js/45.04ab7d0c.js"><link rel="prefetch" href="/notebook/assets/js/46.3f961352.js"><link rel="prefetch" href="/notebook/assets/js/47.92631b9c.js"><link rel="prefetch" href="/notebook/assets/js/48.18e0260f.js"><link rel="prefetch" href="/notebook/assets/js/49.aa8aa0b3.js"><link rel="prefetch" href="/notebook/assets/js/5.eea96393.js"><link rel="prefetch" href="/notebook/assets/js/50.cdaab00a.js"><link rel="prefetch" href="/notebook/assets/js/51.6ac5fe42.js"><link rel="prefetch" href="/notebook/assets/js/52.cefb81e9.js"><link rel="prefetch" href="/notebook/assets/js/53.247aa85e.js"><link rel="prefetch" href="/notebook/assets/js/54.b24e7b49.js"><link rel="prefetch" href="/notebook/assets/js/55.7037e44b.js"><link rel="prefetch" href="/notebook/assets/js/56.b15c875e.js"><link rel="prefetch" href="/notebook/assets/js/57.2211c958.js"><link rel="prefetch" href="/notebook/assets/js/58.5859ad64.js"><link rel="prefetch" href="/notebook/assets/js/59.2821224f.js"><link rel="prefetch" href="/notebook/assets/js/6.f9ff5974.js"><link rel="prefetch" href="/notebook/assets/js/60.08ad3757.js"><link rel="prefetch" href="/notebook/assets/js/61.32b19e10.js"><link rel="prefetch" href="/notebook/assets/js/62.b0c0d84f.js"><link rel="prefetch" href="/notebook/assets/js/63.bea9ec10.js"><link rel="prefetch" href="/notebook/assets/js/64.5d601998.js"><link rel="prefetch" href="/notebook/assets/js/65.343c0909.js"><link rel="prefetch" href="/notebook/assets/js/66.d47aa552.js"><link rel="prefetch" href="/notebook/assets/js/67.977744c8.js"><link rel="prefetch" href="/notebook/assets/js/68.4394a102.js"><link rel="prefetch" href="/notebook/assets/js/69.6cc7a1e0.js"><link rel="prefetch" href="/notebook/assets/js/7.4f93d9e7.js"><link rel="prefetch" href="/notebook/assets/js/70.a11020ae.js"><link rel="prefetch" href="/notebook/assets/js/71.6257d16d.js"><link rel="prefetch" href="/notebook/assets/js/72.1d26dfcc.js"><link rel="prefetch" href="/notebook/assets/js/73.ca74fd26.js"><link rel="prefetch" href="/notebook/assets/js/74.a6b54642.js"><link rel="prefetch" href="/notebook/assets/js/75.c657901a.js"><link rel="prefetch" href="/notebook/assets/js/76.7dfe1ee7.js"><link rel="prefetch" href="/notebook/assets/js/77.97f18096.js"><link rel="prefetch" href="/notebook/assets/js/78.4b79ec7a.js"><link rel="prefetch" href="/notebook/assets/js/79.fcfee72d.js"><link rel="prefetch" href="/notebook/assets/js/8.c753f970.js"><link rel="prefetch" href="/notebook/assets/js/80.1e9c820c.js"><link rel="prefetch" href="/notebook/assets/js/81.2f49df5c.js"><link rel="prefetch" href="/notebook/assets/js/9.09cc437f.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.cc688538.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><!----> <span class="site-name">notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/notebook/high-performance-web-site/" class="sidebar-link">高性能网站建设指南</a></li><li><a href="/notebook/illustration-HTTP/" class="sidebar-link">图解HTTP</a></li><li><a href="/notebook/functional-programming-in-javascript/" class="sidebar-link">JavaScript函数式编程指南</a></li><li><a href="/notebook/javascript-framework-design/" class="sidebar-link">JavaScript框架设计</a></li><li><a href="/notebook/front-end-architecture/" class="sidebar-link">前端架构设计</a></li><li><a href="/notebook/web-performance-in-action/" class="sidebar-link">web性能实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化css" class="sidebar-link">优化CSS</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化图片" class="sidebar-link">优化图片</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化字体" class="sidebar-link">优化字体</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化javascript" class="sidebar-link">优化JavaScript</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#基于service-worker和cacahestorage缓存资源" class="sidebar-link">基于service-worker和cacaheStorage缓存资源</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#使用资源提示" class="sidebar-link">使用资源提示</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#http2优化" class="sidebar-link">HTTP2优化</a></li></ul></li><li><a href="/notebook/css-in-depth/" class="sidebar-link">深入解析 CSS</a></li><li><a href="/notebook/web-security/" class="sidebar-link">白帽子讲Web安全</a></li><li><a href="/notebook/effective-typescript/" aria-current="page" class="active sidebar-link">Effective TypeScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#getting-to-know-typescript" class="sidebar-link">Getting to Know TypeScript</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#type-inference" class="sidebar-link">Type Inference</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#type-design" class="sidebar-link">Type Design</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="effective-typescript"><a href="#effective-typescript" class="header-anchor">#</a> <a href="https://book.douban.com/subject/34893998/" target="_blank" rel="noopener noreferrer">Effective TypeScript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <h2 id="getting-to-know-typescript"><a href="#getting-to-know-typescript" class="header-anchor">#</a> Getting to Know TypeScript</h2> <h3 id="_1-understand-the-relationship-between-typescript-and-javascript"><a href="#_1-understand-the-relationship-between-typescript-and-javascript" class="header-anchor">#</a> 1. Understand the Relationship Between TypeScript and JavaScript</h3> <p>TypeScript 是 JavaScript 的超集</p> <h3 id="_2-know-which-typescript-options-you-re-using"><a href="#_2-know-which-typescript-options-you-re-using" class="header-anchor">#</a> 2. Know Which TypeScript Options You're Using</h3> <p>TypeScript提供了可以影响语言层面的配置，比如 noImplicitAny strictNullChecks。显然要选择尽可能严格的配置。</p> <h3 id="_3-understand-that-code-generation-is-independent-of-types"><a href="#_3-understand-that-code-generation-is-independent-of-types" class="header-anchor">#</a> 3. Understand That Code Generation Is Independent of Types</h3> <p>代码生成和类型检查是独立的。</p> <ul><li>类型报错也可以生成代码</li> <li>运行时没有TS类型</li> <li>断言类型不影响运行时类型</li> <li>运行时类型和声明的类型可能不一致</li> <li>不支持静态重载，只支持类型签名实现重载</li> <li>TS类型不影响运行时性能</li></ul> <h3 id="_4-get-comfortable-with-structural-typing"><a href="#_4-get-comfortable-with-structural-typing" class="header-anchor">#</a> 4. Get Comfortable with Structural Typing</h3> <p>JS是鸭子类型，TS通过结构化类型对此进行描述。子类型不一定通过extends(继承)实现，只要结构满足依然视为子类型。</p> <h3 id="_5-limit-use-of-the-any-type"><a href="#_5-limit-use-of-the-any-type" class="header-anchor">#</a> 5. Limit Use of the any Type</h3> <h2 id="type-inference"><a href="#type-inference" class="header-anchor">#</a> Type Inference</h2> <h3 id="_19-avoid-cluttering-your-code-with-inferable-types"><a href="#_19-avoid-cluttering-your-code-with-inferable-types" class="header-anchor">#</a> 19. Avoid Cluttering Your Code with Inferable Types</h3> <p>避免对简单的可推导类型进行标注，TypeScript可以自动推导,而且后期改动的时候要改的地方也少。</p> <p>常见的需要手动标注类型的场景：</p> <ul><li>函数参数和返回值类型。(ts规则 noImplicitAny 参数需要标注，不能有隐式any； eslint规则 explicit-function-return-type 函数需要标明返回值类型 )</li> <li>对象字面量(抽出interface利于复用，还可以辅助检查拼写错误(新鲜对象字面量类型) )，空数组(默认是 any[])</li></ul> <h3 id="_20-use-different-variables-for-different-types"><a href="#_20-use-different-variables-for-different-types" class="header-anchor">#</a> 20. Use Different Variables for Different Types</h3> <p>在JavaScript中可以把不同类型的值赋给同一个变量，这是一个非常坏的习惯。</p> <ul><li>变量值改变，类型尽可能不变。</li> <li>不同类型的值应该赋给不同的变量。</li></ul> <h3 id="_21-understand-type-widening"><a href="#_21-understand-type-widening" class="header-anchor">#</a> 21. Understand Type Widening</h3> <p>当使用一个常量初始化变量但是没有声明类型时，TS需要根据初始值决定类型，决定的类型通常会比常量类型要宽。比如<code>let a = 1</code>，TS认为a的类型时number，而初始值的类型是1。</p> <p>通常限制类型断定宽化有这么几种方式：</p> <ul><li>使用const声明变量</li> <li>声明类型</li> <li>使用const断言</li></ul> <h3 id="_22-understand-type-narrowing"><a href="#_22-understand-type-narrowing" class="header-anchor">#</a> 22. Understand Type Narrowing</h3> <p>通常类型收窄是我们主动编码的结果，有以下常见方式：</p> <ul><li>条件判断if typeof in instanceof 相等判断 不相等判断</li> <li>可辨识联合类型 (通过 可辨识字段)</li> <li>自定义类型守卫 (返回类型 x is y)</li></ul> <h3 id="_23-create-objects-all-at-once"><a href="#_23-create-objects-all-at-once" class="header-anchor">#</a> 23. Create Objects All at Once</h3> <p>定义一个对象时，尽可能一次性把属性声明完，这样对于TS类型推导有利，动态加属性 TS可能会报错。</p> <p>如果需要动态加属性，推荐使用spread operator：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> ab <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>a<span class="token punctuation">,</span><span class="token operator">...</span>b<span class="token punctuation">}</span>
</code></pre></div><p>对于条件性添加属性，为了类型安全，可以在null或者{}上使用spread operator。</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> hasMiddle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> firstLast <span class="token operator">=</span> <span class="token punctuation">{</span>first<span class="token operator">:</span><span class="token string">'First'</span><span class="token punctuation">,</span>last<span class="token operator">:</span><span class="token string">'last'</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>firstLast<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">(</span>hasMiddle<span class="token operator">?</span><span class="token punctuation">{</span>middle<span class="token operator">:</span><span class="token string">'M'</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><p>name此时的类型为：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">name</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    first<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>
    last<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token punctuation">{</span>
    first<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>
    last<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>
    middle<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然而想要的是middle可选而不是联合类型</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 处理可选类型</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">addOptional</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token punctuation">,</span><span class="token constant">U</span> <span class="token keyword">extends</span> object<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token operator">:</span><span class="token constant">T</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token constant">U</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token constant">T</span> <span class="token operator">&amp;</span> Partial<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>a<span class="token punctuation">,</span><span class="token operator">...</span>b<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">addOptional</span><span class="token punctuation">(</span>firstLast<span class="token punctuation">,</span>hasMiddle<span class="token operator">?</span><span class="token punctuation">{</span>middle<span class="token operator">:</span><span class="token string">'M'</span><span class="token punctuation">}</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_24-be-consistent-in-your-use-of-aliases"><a href="#_24-be-consistent-in-your-use-of-aliases" class="header-anchor">#</a> 24. Be Consistent in Your Use of Aliases</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Whatever</span> <span class="token punctuation">{</span>
    str<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj<span class="token operator">:</span>Whatever <span class="token operator">=</span> <span class="token punctuation">{</span>
    str<span class="token operator">:</span><span class="token string">'meow'</span>
<span class="token punctuation">}</span>
<span class="token comment">// str 是 obj.str的别名</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> obj<span class="token punctuation">.</span>str<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>str<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// obj.str 现在是string类型</span>
    <span class="token comment">// str 是 string | undefined类型</span>
    <span class="token comment">// 这就是为什么当使用别名和类型收窄时 别名要一致</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_25-use-async-functions-instead-of-callbacks-for-asynchronous-code"><a href="#_25-use-async-functions-instead-of-callbacks-for-asynchronous-code" class="header-anchor">#</a> 25. Use async Functions Instead of Callbacks for Asynchronous Code</h3> <h3 id="_26-understand-how-context-is-used-in-type-inference"><a href="#_26-understand-how-context-is-used-in-type-inference" class="header-anchor">#</a> 26. Understand How Context Is Used in Type Inference</h3> <p>类型推断和上下文有关。一般而言，TS推断变量的类型是根据变量被引入时，而不是使用时，通常伴随着之前的Type Widening现象。</p> <h3 id="_27-use-functional-constructs-and-libraries-to-help-types-flow"><a href="#_27-use-functional-constructs-and-libraries-to-help-types-flow" class="header-anchor">#</a> 27. Use Functional Constructs and Libraries to Help Types Flow</h3> <h2 id="type-design"><a href="#type-design" class="header-anchor">#</a> Type Design</h2> <h3 id="_28-prefer-types-that-always-represent-valid-states"><a href="#_28-prefer-types-that-always-represent-valid-states" class="header-anchor">#</a> 28. Prefer Types That Always Represent Valid States</h3> <p>避免使用一个类型多个变量建模状态，用可辨识的多个类型联合建模状态。</p> <h3 id="_29-be-liberal-in-what-you-accept-and-strict-in-what-you-produce"><a href="#_29-be-liberal-in-what-you-accept-and-strict-in-what-you-produce" class="header-anchor">#</a> 29. Be Liberal in What You Accept and Strict in What You Produce</h3> <p>对入参宽松(支持多种类型参数)，对出参严格(统一格式)</p> <h3 id="_30-don-t-repeat-type-infomation-in-document"><a href="#_30-don-t-repeat-type-infomation-in-document" class="header-anchor">#</a> 30. Don't Repeat Type Infomation in Document</h3> <h3 id="_31-push-null-values-to-the-perimeter-of-your-type"><a href="#_31-push-null-values-to-the-perimeter-of-your-type" class="header-anchor">#</a> 31. Push Null Values to the Perimeter of Your Type</h3> <ul><li>Avoid designs in which one value being null or not null is implicitly related to another value being null or not null</li> <li>Push null values to the perimeter of your API by making larger objects either null or fully non-null. This will make code clearer both for human readers and for the type checker.</li> <li>Consider creating a fully non-null class and constructing it when all values are available.</li></ul> <h3 id="_32-prefer-unions-of-interfaces-to-interfaces-of-unions"><a href="#_32-prefer-unions-of-interfaces-to-interfaces-of-unions" class="header-anchor">#</a> 32. Prefer Unions of Interfaces to Interfaces of Unions</h3> <p>考虑下述类型定义</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Layer</span> <span class="token punctuation">{</span>
  layout<span class="token operator">:</span> FillLayout <span class="token operator">|</span> LineLayout <span class="token operator">|</span> PointLayout<span class="token punctuation">;</span>
  paint<span class="token operator">:</span> FillPaint <span class="token operator">|</span> LinePaint <span class="token operator">|</span> PointPaint
<span class="token punctuation">}</span>
</code></pre></div><p>这样设计的类型很难关联layout和对应的paint,重构如下</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">FillLayer</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'fill'</span><span class="token punctuation">,</span>
  layout<span class="token operator">:</span> FillLayout<span class="token punctuation">,</span>
  paint<span class="token operator">:</span> FillPaint
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">LineLayer</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
  layout<span class="token operator">:</span> LineLayout<span class="token punctuation">,</span>
  paint<span class="token operator">:</span> LinePaint
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">PointLayer</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'paint'</span><span class="token punctuation">,</span>
  layout<span class="token operator">:</span> PointLayout<span class="token punctuation">,</span>
  paint<span class="token operator">:</span> PointPaint
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Layer</span> <span class="token operator">=</span> FillLayer <span class="token operator">|</span> LineLayer <span class="token operator">|</span>PointLayer
</code></pre></div><p>和28类似，都是使用可辨识联合类型，处理有关联的多个字段。</p> <h3 id="_33-prefer-more-precise-alternatives-to-string-types"><a href="#_33-prefer-more-precise-alternatives-to-string-types" class="header-anchor">#</a> 33. Prefer More Precise Alternatives to String Types</h3> <h3 id="_34-prefer-incomplete-types-to-inaccurate-types"><a href="#_34-prefer-incomplete-types-to-inaccurate-types" class="header-anchor">#</a> 34. Prefer Incomplete Types to Inaccurate Types</h3> <h3 id="_35-generate-types-from-apis-and-specs-not-data"><a href="#_35-generate-types-from-apis-and-specs-not-data" class="header-anchor">#</a> 35. Generate Types from APIs and Specs, Not Data</h3> <h3 id="_36-name-types-using-the-language-of-your-problem-domain"><a href="#_36-name-types-using-the-language-of-your-problem-domain" class="header-anchor">#</a> 36. Name Types Using the Language of Your Problem Domain</h3> <h3 id="_37-consider-brands-for-norminal-typing"><a href="#_37-consider-brands-for-norminal-typing" class="header-anchor">#</a> 37. Consider &quot;Brands&quot; for Norminal Typing</h3> <p>TS时结构化类型而不是名义类型，模拟名义类型可以参考<a href="https://react-typescript-cheatsheet.netlify.app/docs/basic/troubleshooting/types/#simulating-nominal-types" target="_blank" rel="noopener noreferrer">Simulating Nominal Types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">OrderID</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token keyword">readonly</span> brand<span class="token operator">:</span> unique <span class="token builtin">symbol</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">UserID</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token keyword">readonly</span> brand<span class="token operator">:</span> unique <span class="token builtin">symbol</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">ID</span></span> <span class="token operator">=</span> OrderID <span class="token operator">|</span> UserID<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">OrderID</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> id <span class="token keyword">as</span> OrderID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">UserID</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> id <span class="token keyword">as</span> UserID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">queryForUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> UserID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token function">queryForUser</span><span class="token punctuation">(</span><span class="token function">OrderID</span><span class="token punctuation">(</span><span class="token string">&quot;foobar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error, Argument of type 'OrderID' is not assignable to parameter of type 'UserID'</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notebook/web-security/" class="prev">
        白帽子讲Web安全
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook/assets/js/app.e017193e.js" defer></script><script src="/notebook/assets/js/2.ddaab4c9.js" defer></script><script src="/notebook/assets/js/23.23a0fe48.js" defer></script>
  </body>
</html>
