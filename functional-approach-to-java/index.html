<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>A Functional Approach to Java | notebook</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/notebook/favicon.ico">
    <meta name="description" content="">
    <link rel="preload" href="/notebook/assets/css/0.styles.5dd3b3b5.css" as="style"><link rel="preload" href="/notebook/assets/js/app.144afc9d.js" as="script"><link rel="preload" href="/notebook/assets/js/2.488a9fea.js" as="script"><link rel="preload" href="/notebook/assets/js/49.ae90d64e.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.ce3e4382.js"><link rel="prefetch" href="/notebook/assets/js/100.60a9a04d.js"><link rel="prefetch" href="/notebook/assets/js/101.38b4c872.js"><link rel="prefetch" href="/notebook/assets/js/102.b12faa07.js"><link rel="prefetch" href="/notebook/assets/js/103.81996826.js"><link rel="prefetch" href="/notebook/assets/js/104.f8923391.js"><link rel="prefetch" href="/notebook/assets/js/105.80409daa.js"><link rel="prefetch" href="/notebook/assets/js/106.875aa2dc.js"><link rel="prefetch" href="/notebook/assets/js/107.7a9a9f6d.js"><link rel="prefetch" href="/notebook/assets/js/108.ea17a4da.js"><link rel="prefetch" href="/notebook/assets/js/109.1a0257e3.js"><link rel="prefetch" href="/notebook/assets/js/11.08545a79.js"><link rel="prefetch" href="/notebook/assets/js/110.8389bc22.js"><link rel="prefetch" href="/notebook/assets/js/111.6bca4aad.js"><link rel="prefetch" href="/notebook/assets/js/112.4655b12c.js"><link rel="prefetch" href="/notebook/assets/js/113.810bc6f1.js"><link rel="prefetch" href="/notebook/assets/js/114.be047ab2.js"><link rel="prefetch" href="/notebook/assets/js/115.6649dd68.js"><link rel="prefetch" href="/notebook/assets/js/116.59674026.js"><link rel="prefetch" href="/notebook/assets/js/117.d4fdc0b6.js"><link rel="prefetch" href="/notebook/assets/js/118.52b31427.js"><link rel="prefetch" href="/notebook/assets/js/119.30b7fb9e.js"><link rel="prefetch" href="/notebook/assets/js/12.bacc8c80.js"><link rel="prefetch" href="/notebook/assets/js/120.f602f74f.js"><link rel="prefetch" href="/notebook/assets/js/121.d9cfbc1e.js"><link rel="prefetch" href="/notebook/assets/js/122.1e504564.js"><link rel="prefetch" href="/notebook/assets/js/123.a6941979.js"><link rel="prefetch" href="/notebook/assets/js/124.6bdb7a3b.js"><link rel="prefetch" href="/notebook/assets/js/125.aaf9b49a.js"><link rel="prefetch" href="/notebook/assets/js/126.0d8ed22a.js"><link rel="prefetch" href="/notebook/assets/js/127.c4499cf4.js"><link rel="prefetch" href="/notebook/assets/js/128.95cbcd02.js"><link rel="prefetch" href="/notebook/assets/js/129.caadaa66.js"><link rel="prefetch" href="/notebook/assets/js/13.b585d21a.js"><link rel="prefetch" href="/notebook/assets/js/130.f26b45ee.js"><link rel="prefetch" href="/notebook/assets/js/131.6dafd98c.js"><link rel="prefetch" href="/notebook/assets/js/132.340a1bf0.js"><link rel="prefetch" href="/notebook/assets/js/133.e5d7b68c.js"><link rel="prefetch" href="/notebook/assets/js/134.6b75c6c1.js"><link rel="prefetch" href="/notebook/assets/js/135.79df4987.js"><link rel="prefetch" href="/notebook/assets/js/136.f1c08ac5.js"><link rel="prefetch" href="/notebook/assets/js/137.66ff3f53.js"><link rel="prefetch" href="/notebook/assets/js/138.38873d69.js"><link rel="prefetch" href="/notebook/assets/js/139.9f971edf.js"><link rel="prefetch" href="/notebook/assets/js/14.41201685.js"><link rel="prefetch" href="/notebook/assets/js/140.7a82786e.js"><link rel="prefetch" href="/notebook/assets/js/141.e4f786df.js"><link rel="prefetch" href="/notebook/assets/js/142.41616f14.js"><link rel="prefetch" href="/notebook/assets/js/143.19740ed0.js"><link rel="prefetch" href="/notebook/assets/js/144.49d254ea.js"><link rel="prefetch" href="/notebook/assets/js/145.2e93a07a.js"><link rel="prefetch" href="/notebook/assets/js/146.fccd04ac.js"><link rel="prefetch" href="/notebook/assets/js/147.8ac231a8.js"><link rel="prefetch" href="/notebook/assets/js/148.916c24ac.js"><link rel="prefetch" href="/notebook/assets/js/149.4470993a.js"><link rel="prefetch" href="/notebook/assets/js/15.935505de.js"><link rel="prefetch" href="/notebook/assets/js/150.d5077bb8.js"><link rel="prefetch" href="/notebook/assets/js/151.afbb81e9.js"><link rel="prefetch" href="/notebook/assets/js/152.287f336b.js"><link rel="prefetch" href="/notebook/assets/js/153.16ee457d.js"><link rel="prefetch" href="/notebook/assets/js/154.4e435c5c.js"><link rel="prefetch" href="/notebook/assets/js/155.792a6df4.js"><link rel="prefetch" href="/notebook/assets/js/156.0d5d1433.js"><link rel="prefetch" href="/notebook/assets/js/157.46ad2b31.js"><link rel="prefetch" href="/notebook/assets/js/158.05d351b7.js"><link rel="prefetch" href="/notebook/assets/js/16.d3f692e4.js"><link rel="prefetch" href="/notebook/assets/js/17.3162838c.js"><link rel="prefetch" href="/notebook/assets/js/18.9f8ef7f0.js"><link rel="prefetch" href="/notebook/assets/js/19.6b174c29.js"><link rel="prefetch" href="/notebook/assets/js/20.ed6f9a66.js"><link rel="prefetch" href="/notebook/assets/js/21.a21cd508.js"><link rel="prefetch" href="/notebook/assets/js/22.25ef7a2b.js"><link rel="prefetch" href="/notebook/assets/js/23.4ea80924.js"><link rel="prefetch" href="/notebook/assets/js/24.a2ac60b8.js"><link rel="prefetch" href="/notebook/assets/js/25.62b07b06.js"><link rel="prefetch" href="/notebook/assets/js/26.5934acf5.js"><link rel="prefetch" href="/notebook/assets/js/27.3b9ad8c2.js"><link rel="prefetch" href="/notebook/assets/js/28.32543f8f.js"><link rel="prefetch" href="/notebook/assets/js/29.260d0599.js"><link rel="prefetch" href="/notebook/assets/js/3.97388bd3.js"><link rel="prefetch" href="/notebook/assets/js/30.d5cb593d.js"><link rel="prefetch" href="/notebook/assets/js/31.e7f497cc.js"><link rel="prefetch" href="/notebook/assets/js/32.1da76202.js"><link rel="prefetch" href="/notebook/assets/js/33.74eda9b2.js"><link rel="prefetch" href="/notebook/assets/js/34.96b54cbc.js"><link rel="prefetch" href="/notebook/assets/js/35.c8e820c0.js"><link rel="prefetch" href="/notebook/assets/js/36.ad5dc77e.js"><link rel="prefetch" href="/notebook/assets/js/37.e5d2fd59.js"><link rel="prefetch" href="/notebook/assets/js/38.7453ac28.js"><link rel="prefetch" href="/notebook/assets/js/39.82f3ec82.js"><link rel="prefetch" href="/notebook/assets/js/4.c1b71ae8.js"><link rel="prefetch" href="/notebook/assets/js/40.80aa26ee.js"><link rel="prefetch" href="/notebook/assets/js/41.eafa89a2.js"><link rel="prefetch" href="/notebook/assets/js/42.67659e08.js"><link rel="prefetch" href="/notebook/assets/js/43.82d77702.js"><link rel="prefetch" href="/notebook/assets/js/44.80dcc6dd.js"><link rel="prefetch" href="/notebook/assets/js/45.4d7cdf98.js"><link rel="prefetch" href="/notebook/assets/js/46.42f8aa34.js"><link rel="prefetch" href="/notebook/assets/js/47.c4903aa2.js"><link rel="prefetch" href="/notebook/assets/js/48.3e5ea08a.js"><link rel="prefetch" href="/notebook/assets/js/5.e1449fe9.js"><link rel="prefetch" href="/notebook/assets/js/50.2752a3e4.js"><link rel="prefetch" href="/notebook/assets/js/51.4d42aea6.js"><link rel="prefetch" href="/notebook/assets/js/52.c24eb3fa.js"><link rel="prefetch" href="/notebook/assets/js/53.c989a621.js"><link rel="prefetch" href="/notebook/assets/js/54.eafb25c9.js"><link rel="prefetch" href="/notebook/assets/js/55.f62fb48a.js"><link rel="prefetch" href="/notebook/assets/js/56.04f52f7b.js"><link rel="prefetch" href="/notebook/assets/js/57.b8aa8a28.js"><link rel="prefetch" href="/notebook/assets/js/58.920f504c.js"><link rel="prefetch" href="/notebook/assets/js/59.fe51f61a.js"><link rel="prefetch" href="/notebook/assets/js/6.93830377.js"><link rel="prefetch" href="/notebook/assets/js/60.82cf674e.js"><link rel="prefetch" href="/notebook/assets/js/61.4b460304.js"><link rel="prefetch" href="/notebook/assets/js/62.13db8ece.js"><link rel="prefetch" href="/notebook/assets/js/63.dde40755.js"><link rel="prefetch" href="/notebook/assets/js/64.53e691e3.js"><link rel="prefetch" href="/notebook/assets/js/65.b2ee4bd0.js"><link rel="prefetch" href="/notebook/assets/js/66.3971a441.js"><link rel="prefetch" href="/notebook/assets/js/67.3733a8da.js"><link rel="prefetch" href="/notebook/assets/js/68.065c95ed.js"><link rel="prefetch" href="/notebook/assets/js/69.918af9ce.js"><link rel="prefetch" href="/notebook/assets/js/7.b68fe584.js"><link rel="prefetch" href="/notebook/assets/js/70.2ed0a8fe.js"><link rel="prefetch" href="/notebook/assets/js/71.ed401be9.js"><link rel="prefetch" href="/notebook/assets/js/72.153e8906.js"><link rel="prefetch" href="/notebook/assets/js/73.bae0d215.js"><link rel="prefetch" href="/notebook/assets/js/74.e4c8e82d.js"><link rel="prefetch" href="/notebook/assets/js/75.e2cba650.js"><link rel="prefetch" href="/notebook/assets/js/76.e38aa1e8.js"><link rel="prefetch" href="/notebook/assets/js/77.f6f31b1b.js"><link rel="prefetch" href="/notebook/assets/js/78.6746ad73.js"><link rel="prefetch" href="/notebook/assets/js/79.895cb38d.js"><link rel="prefetch" href="/notebook/assets/js/8.3f6c8709.js"><link rel="prefetch" href="/notebook/assets/js/80.9dd413c6.js"><link rel="prefetch" href="/notebook/assets/js/81.307f123d.js"><link rel="prefetch" href="/notebook/assets/js/82.73af103a.js"><link rel="prefetch" href="/notebook/assets/js/83.c999240a.js"><link rel="prefetch" href="/notebook/assets/js/84.aefe5b2c.js"><link rel="prefetch" href="/notebook/assets/js/85.b6aec5a0.js"><link rel="prefetch" href="/notebook/assets/js/86.0f3d5f15.js"><link rel="prefetch" href="/notebook/assets/js/87.5f4c9d6d.js"><link rel="prefetch" href="/notebook/assets/js/88.534d706c.js"><link rel="prefetch" href="/notebook/assets/js/89.2a843179.js"><link rel="prefetch" href="/notebook/assets/js/9.ee3503b4.js"><link rel="prefetch" href="/notebook/assets/js/90.af7c60a5.js"><link rel="prefetch" href="/notebook/assets/js/91.779e5925.js"><link rel="prefetch" href="/notebook/assets/js/92.c1edd1f6.js"><link rel="prefetch" href="/notebook/assets/js/93.4fb14ba7.js"><link rel="prefetch" href="/notebook/assets/js/94.eae83f9f.js"><link rel="prefetch" href="/notebook/assets/js/95.f5fc7085.js"><link rel="prefetch" href="/notebook/assets/js/96.7497899c.js"><link rel="prefetch" href="/notebook/assets/js/97.bb8bd46c.js"><link rel="prefetch" href="/notebook/assets/js/98.637d7a09.js"><link rel="prefetch" href="/notebook/assets/js/99.7045183f.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.5dd3b3b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><!----> <span class="site-name">notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/notebook/high-performance-web-site/" class="sidebar-link">高性能网站建设指南</a></li><li><a href="/notebook/illustration-HTTP/" class="sidebar-link">图解HTTP</a></li><li><a href="/notebook/functional-programming-in-javascript/" class="sidebar-link">JavaScript函数式编程指南</a></li><li><a href="/notebook/javascript-framework-design/" class="sidebar-link">JavaScript框架设计</a></li><li><a href="/notebook/front-end-architecture/" class="sidebar-link">前端架构设计</a></li><li><a href="/notebook/web-performance-in-action/" class="sidebar-link">web性能实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化css" class="sidebar-link">优化CSS</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化图片" class="sidebar-link">优化图片</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化字体" class="sidebar-link">优化字体</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#优化javascript" class="sidebar-link">优化JavaScript</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#基于service-worker和cacahestorage缓存资源" class="sidebar-link">基于service-worker和cacaheStorage缓存资源</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#使用资源提示" class="sidebar-link">使用资源提示</a></li><li class="sidebar-sub-header"><a href="/notebook/web-performance-in-action/#http2优化" class="sidebar-link">HTTP2优化</a></li></ul></li><li><a href="/notebook/css-in-depth/" class="sidebar-link">深入解析 CSS</a></li><li><a href="/notebook/web-security/" class="sidebar-link">白帽子讲Web安全</a></li><li><a href="/notebook/effective-typescript/" class="sidebar-link">Effective TypeScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#getting-to-know-typescript" class="sidebar-link">Getting to Know TypeScript</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#typescript-t-type-system" class="sidebar-link">TypeScript't Type System</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#type-inference" class="sidebar-link">Type Inference</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#type-design" class="sidebar-link">Type Design</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#working-with-any" class="sidebar-link">Working with any</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#types-declarations-and-types" class="sidebar-link">Types Declarations and @types</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#writing-and-running-your-code" class="sidebar-link">Writing and Running Your Code</a></li><li class="sidebar-sub-header"><a href="/notebook/effective-typescript/#migrating-to-typescript" class="sidebar-link">Migrating to TypeScript</a></li></ul></li><li><a href="/notebook/nodejs-in-practice/" class="sidebar-link">Node.js硬实战：115个核心技巧</a></li><li><a href="/notebook/mastering-modular-javascript/" class="sidebar-link">精通模块化JavaScript</a></li><li><a href="/notebook/svg-essentials/" class="sidebar-link">SVG精髓</a></li><li><a href="/notebook/nodejs-in-depth/" class="sidebar-link">深入浅出Node.js</a></li><li><a href="/notebook/interesting-algorithm-puzzles-for-programmers/" class="sidebar-link">程序员的算法趣题</a></li><li><a href="/notebook/java-by-comparison/" class="sidebar-link">Java By Comparison</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#start-cleaning-up" class="sidebar-link">Start Cleaning Up</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#level-up-your-code-style" class="sidebar-link">Level Up Your Code Style</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#use-comments-wisely" class="sidebar-link">Use Comments Wisely</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#name-things-right" class="sidebar-link">Name Things Right</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#prepare-for-things-going-wrong" class="sidebar-link">Prepare for Things Going Wrong</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#assert-things-going-right" class="sidebar-link">Assert Things Going Right</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#design-your-objects" class="sidebar-link">Design Your Objects</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#let-your-data-flow" class="sidebar-link">Let Your Data Flow</a></li><li class="sidebar-sub-header"><a href="/notebook/java-by-comparison/#prepare-for-the-real-world" class="sidebar-link">Prepare for the Real World</a></li></ul></li><li><a href="/notebook/solidbook/" class="sidebar-link">Solid Book</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/solidbook/#complexity" class="sidebar-link">Complexity</a></li></ul></li><li><a href="/notebook/unit-testing/" class="sidebar-link">Unit Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#the-goal-of-unit-testing" class="sidebar-link">The goal of unit testing</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#what-is-a-unit-test" class="sidebar-link">What is a unit test</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#the-anatomy-of-a-unit-test" class="sidebar-link">The anatomy of a unit test</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#the-four-pillars-of-a-good-unit-test" class="sidebar-link">The four pillars of a good unit test</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#mocks-and-test-fragility" class="sidebar-link">Mocks and test fragility</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#styles-of-unit-testing" class="sidebar-link">Styles of unit testing</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#refactoring-toward-valuable-unit-tests" class="sidebar-link">Refactoring toward valuable unit tests</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#why-integration-testing" class="sidebar-link">Why integration testing</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#mocking-best-practices" class="sidebar-link">Mocking best practices</a></li><li class="sidebar-sub-header"><a href="/notebook/unit-testing/#unit-testing-anti-patterns" class="sidebar-link">Unit testing anti-patterns</a></li></ul></li><li><a href="/notebook/the-art-of-unit-testing/" class="sidebar-link">The Art of Unit Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#the-basics-of-unit-testing" class="sidebar-link">The basics of unit testing</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#a-first-unit-test" class="sidebar-link">A first unit test</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#breaking-dependencies-with-stub" class="sidebar-link">Breaking dependencies with stub</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#interaction-testing-using-mock-objects" class="sidebar-link">Interaction testing using mock objects</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#isolation-frameworks" class="sidebar-link">Isolation frameworks</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#unit-testing-asynchronous-code" class="sidebar-link">Unit testing asynchronous code</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#trustworthy-tests" class="sidebar-link">Trustworthy tests</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#maintainability" class="sidebar-link">Maintainability</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#readability" class="sidebar-link">Readability</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#developing-a-testing-strategy" class="sidebar-link">Developing a testing strategy</a></li><li class="sidebar-sub-header"><a href="/notebook/the-art-of-unit-testing/#monkey-patching-functions-and-modules" class="sidebar-link">Monkey-patching functions and modules</a></li></ul></li><li><a href="/notebook/modern-java-recipe/" class="sidebar-link">Modern Java Recipes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#the-basics" class="sidebar-link">The Basics</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#the-java-util-function-package" class="sidebar-link">The java.util.function Package</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#streams" class="sidebar-link">Streams</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#comparators-and-collectors" class="sidebar-link">Comparators and Collectors</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#issues-with-streams-lambdas-and-method-references" class="sidebar-link">Issues with Streams, Lambdas, and Method References</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#the-optional-type" class="sidebar-link">The Optional Type</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#file-i-o" class="sidebar-link">File I/O</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#the-java-time-package" class="sidebar-link">The java.time Package</a></li><li class="sidebar-sub-header"><a href="/notebook/modern-java-recipe/#parallelism-and-concurrency" class="sidebar-link">Parallelism and Concurrency</a></li></ul></li><li><a href="/notebook/fluent-react/" class="sidebar-link">Fluent React</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/fluent-react/#jsx" class="sidebar-link">JSX</a></li><li class="sidebar-sub-header"><a href="/notebook/fluent-react/#the-virtual-dom" class="sidebar-link">The Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/notebook/fluent-react/#inside-reconciliation" class="sidebar-link">Inside Reconciliation</a></li><li class="sidebar-sub-header"><a href="/notebook/fluent-react/#common-questions-and-powerful-patterns" class="sidebar-link">Common Questions and Powerful Patterns</a></li><li class="sidebar-sub-header"><a href="/notebook/fluent-react/#framesworks" class="sidebar-link">Framesworks</a></li></ul></li><li><a href="/notebook/advanced-react/" class="sidebar-link">Advanced React</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#intro-to-re-renders" class="sidebar-link">Intro-to re-renders</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#elements-children-as-props-and-re-renders-components-as-props-pattern" class="sidebar-link">Elements, children as props, and re-renders (Components as Props Pattern)</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#configuration-concerns-with-elements-as-props" class="sidebar-link">Configuration concerns with elements as props</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#advanced-configuration-with-render-props" class="sidebar-link">Advanced configuration with render props</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#memorization-with-usememo-usecallback-and-react-memo" class="sidebar-link">Memorization with useMemo useCallback and React.memo</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#deep-dive-into-diffing-and-reconciliation" class="sidebar-link">Deep dive into diffing and reconciliation</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#hoc-in-modern-world" class="sidebar-link">HOC in modern world</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#react-context-and-performance" class="sidebar-link">React Context and Performance</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#refs-from-storing-data-to-imperative-api" class="sidebar-link">Refs: from storing data to imperative API</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#closures-in-react" class="sidebar-link">Closures in React</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#implementing-advanced-debouncing-and-throttling-with-refs" class="sidebar-link">Implementing advanced debouncing and throttling with Refs</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#escaping-flickering-ui-with-uselayouteffect" class="sidebar-link">Escaping Flickering UI with useLayoutEffect</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#react-portals-and-why-do-we-need-them" class="sidebar-link">React portals and why do we need them</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#data-fetching-on-the-client-and-performance" class="sidebar-link">Data fetching on the client and performance</a></li><li class="sidebar-sub-header"><a href="/notebook/advanced-react/#data-fetching-and-race-conditions" class="sidebar-link">Data fetching and race conditions</a></li></ul></li><li><a href="/notebook/functional-approach-to-java/" aria-current="page" class="active sidebar-link">A Functional Approach to Java</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#an-introduction-to-functional-programming" class="sidebar-link">An Introduction to Functional Programming</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#functional-java" class="sidebar-link">Functional Java</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#functional-interfaces-of-the-jdk" class="sidebar-link">Functional Interfaces of the JDK</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#immutability-2" class="sidebar-link">Immutability</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#working-with-records" class="sidebar-link">Working with Records</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#data-processing-with-streams" class="sidebar-link">Data Processing with Streams</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#working-with-streams" class="sidebar-link">Working with Streams</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#parallel-data-processing-with-streams" class="sidebar-link">Parallel Data Processing with Streams</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#handing-null-with-optionals" class="sidebar-link">Handing null with Optionals</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#functional-exception-handling" class="sidebar-link">Functional Exception Handling</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#lazy-evaluation-2" class="sidebar-link">Lazy Evaluation</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#asynchronous-tasks" class="sidebar-link">Asynchronous Tasks</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-approach-to-java/#functional-design-patterns" class="sidebar-link">Functional Design Patterns</a></li></ul></li><li><a href="/notebook/functional-programming-in-java-bookshelf/" class="sidebar-link">Functional Programming in Java</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/functional-programming-in-java-bookshelf/#error-handling" class="sidebar-link">Error Handling</a></li><li class="sidebar-sub-header"><a href="/notebook/functional-programming-in-java-bookshelf/#functional-programming-idioms" class="sidebar-link">Functional Programming Idioms</a></li></ul></li><li><a href="/notebook/micro-frontends-in-action/" class="sidebar-link">Micro Frontends in Action</a></li><li><a href="/notebook/web-accessibility-cookbook/" class="sidebar-link">Web Accessibility Cookbook</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#structuring-documents" class="sidebar-link">Structuring Documents</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#structuring-pages" class="sidebar-link">Structuring Pages</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#linking-content" class="sidebar-link">Linking Content</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#performing-actions" class="sidebar-link">Performing Actions</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#styling-content" class="sidebar-link">Styling Content</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#managing-focus" class="sidebar-link">Managing Focus</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#navigating-sites" class="sidebar-link">Navigating Sites</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#toggling-content-visibility" class="sidebar-link">Toggling Content Visibility</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#constructing-forms" class="sidebar-link">Constructing Forms</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#presenting-tabular-data" class="sidebar-link">Presenting Tabular Data</a></li><li class="sidebar-sub-header"><a href="/notebook/web-accessibility-cookbook/#creating-custom-elements" class="sidebar-link">Creating Custom Elements</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="a-functional-approach-to-java"><a href="#a-functional-approach-to-java" class="header-anchor">#</a> <a href="https://book.douban.com/subject/36730694/" target="_blank" rel="noopener noreferrer">A Functional Approach to Java<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <h2 id="an-introduction-to-functional-programming"><a href="#an-introduction-to-functional-programming" class="header-anchor">#</a> An Introduction to Functional Programming</h2> <h3 id="functional-programming-concepts"><a href="#functional-programming-concepts" class="header-anchor">#</a> Functional Programming Concepts</h3> <h4 id="pure-functions"><a href="#pure-functions" class="header-anchor">#</a> Pure Functions</h4> <p>Pure functions have two elemental guarantees:</p> <ul><li>The same input will always create the same output</li> <li>They are self-contained without any kind of side effect</li></ul> <h4 id="referential-transparency"><a href="#referential-transparency" class="header-anchor">#</a> Referential Transparency</h4> <p>You can replace pure functions with their respective evaluated result for any furthur invocations without changing the behavior of your program.</p> <h4 id="immutability"><a href="#immutability" class="header-anchor">#</a> Immutability</h4> <p>With immutability, data structures can no longer change after their initialization. By never changing, they are always consistent, side-effect-free, predictable, and easier to reason with. Like pure functions, their usage is safe in concurrent and parallel environments without the usual issues of unsynchronized access or out-of-process state changes.</p> <h4 id="first-class-and-higher-order-functions"><a href="#first-class-and-higher-order-functions" class="header-anchor">#</a> First-Class and Higher-Order Functions</h4> <p>Functions need to be assignable to variables and be used as arguments and return values in other functions and expressions.</p> <p>Higher-order functions use this first-class citizenship to accept functions as arguments or return a function as their result, or both.</p> <h4 id="functional-composition"><a href="#functional-composition" class="header-anchor">#</a> Functional Composition</h4> <h4 id="currying"><a href="#currying" class="header-anchor">#</a> Currying</h4> <h4 id="partial-function-application"><a href="#partial-function-application" class="header-anchor">#</a> Partial Function Application</h4> <p>Partial function application is the process of creating a new function by providing only a subset of the required arguments to an existing one.</p> <h4 id="lazy-evaluation"><a href="#lazy-evaluation" class="header-anchor">#</a> Lazy Evaluation</h4> <p>Lazy evaluation is an evaluation strategy that delays the evaluation of an expression until its result is literally needed by separating the concerns of how you create an expression from when you actually use it.</p> <h3 id="advantages-of-functional-programming"><a href="#advantages-of-functional-programming" class="header-anchor">#</a> Advantages of Functional Programming</h3> <ul><li>Simplicity</li> <li>Consistency</li> <li>(Mathmatical) correctness</li> <li>Safer concurrency</li> <li>Modularity</li> <li>Testability</li></ul> <h2 id="functional-java"><a href="#functional-java" class="header-anchor">#</a> Functional Java</h2> <ul><li>Functional interface are concrete types and representations of Java lambdas</li> <li>Lambda expressions are not syntactic sugar to anonymous classes</li> <li>Outside variables need to be effectively final to be used in lambdas, but this makes only the references immutable, not the undelying data structure.</li> <li>Method references are a concise altenative for matching method signatures and lambda definitions.</li></ul> <h2 id="functional-interfaces-of-the-jdk"><a href="#functional-interfaces-of-the-jdk" class="header-anchor">#</a> Functional Interfaces of the JDK</h2> <p>Big Four Functional Interface Variants:</p> <ul><li>Functions</li> <li>Consumers</li> <li>Suppliers</li> <li>Predicates</li></ul> <p>Function Composition</p> <ul><li>Function
<ul><li>compose</li> <li>andThen</li></ul></li> <li>Predicate
<ul><li>and</li> <li>or</li> <li>negate</li></ul></li> <li>Consumer
<ul><li>andThen</li></ul></li></ul> <h2 id="immutability-2"><a href="#immutability-2" class="header-anchor">#</a> Immutability</h2> <ul><li>String</li> <li>Immutable Collections
<ul><li>Unmodifiable Collections.
Static methods like <code>Collections.unmodifiableList</code> and <code>Collections.unmodifiableSet</code> only provide &quot;unmodifiable view&quot; , but the underlying Collection is still modifiable</li> <li>Immutable Collection factory methods
<ul><li>List.of</li> <li>Set.of</li> <li>Map.of</li></ul></li> <li>Immutable copies (Instead of being a mere view, copyOf creates a new container, holding its own references to the elements )
<ul><li>List.copyOf</li> <li>Set.copyOf</li> <li>Map.copyOf</li></ul></li></ul></li> <li>Primitive Wrapper</li> <li>Immutable Math
<ul><li>BigInteger</li> <li>BigDecimal</li></ul></li> <li>java.time</li> <li>Records</li></ul> <h2 id="working-with-records"><a href="#working-with-records" class="header-anchor">#</a> Working with Records</h2> <h3 id="record-validation-and-data-scrubbing"><a href="#record-validation-and-data-scrubbing" class="header-anchor">#</a> Record Validation and Data Scrubbing</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">User</span><span class="token punctuation">(</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">boolean</span> active<span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span> lastLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>lastLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// normalize</span>
        username <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="increasing-immutability"><a href="#increasing-immutability" class="header-anchor">#</a> Increasing Immutability</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">IncreaseImmutability</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">IncreaseImmutability</span> <span class="token punctuation">{</span>
        values <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="record-as-local-nominal-tuples-improve-expressiveness"><a href="#record-as-local-nominal-tuples-improve-expressiveness" class="header-anchor">#</a> Record as Local Nominal Tuples ( improve expressiveness )</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Comparator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Predicate</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Album</span> <span class="token punctuation">{</span>
    <span class="token keyword">record</span> <span class="token class-name">AlbumPerYear</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> titles<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">AlbumPerYear</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumPerYear</span><span class="token punctuation">&gt;</span></span> <span class="token function">minimumYear</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> albumPerYear <span class="token operator">-&gt;</span> albumPerYear<span class="token punctuation">.</span><span class="token function">year</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span>year<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlbumPerYear</span><span class="token punctuation">&gt;</span></span> <span class="token function">sortByYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">AlbumPerYear</span><span class="token operator">::</span><span class="token function">year</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">filterAlbums</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> albums<span class="token punctuation">,</span> <span class="token keyword">int</span> minimumYear <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> albums<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AlbumPerYear</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">AlbumPerYear</span><span class="token punctuation">.</span><span class="token function">minimumYear</span><span class="token punctuation">(</span>minimumYear<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">AlbumPerYear</span><span class="token punctuation">.</span><span class="token function">sortByYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AlbumPerYear</span><span class="token operator">::</span><span class="token function">titles</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h2 id="data-processing-with-streams"><a href="#data-processing-with-streams" class="header-anchor">#</a> Data Processing with Streams</h2> <p>Stream Features</p> <ul><li>Lazy Evaluation</li> <li>(Mostly) stateless and non-interfering ( operations won't affect the underlying data source in any way, nor does the Stream itself store any elements )</li> <li>Optimizations included</li> <li>Less boilerplate</li> <li>Non-reusable</li> <li>Easy parallelization</li></ul> <p>Intermediate Operation</p> <p>Terminal Operation</p> <h2 id="working-with-streams"><a href="#working-with-streams" class="header-anchor">#</a> Working with Streams</h2> <h3 id="primitive-streams"><a href="#primitive-streams" class="header-anchor">#</a> Primitive Streams</h3> <ul><li>IntStream</li> <li>LongStream</li> <li>DoubleStream</li></ul> <h3 id="iterative-streams"><a href="#iterative-streams" class="header-anchor">#</a> Iterative Streams</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>str<span class="token operator">-&gt;</span>str <span class="token operator">+</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Primitive Streams</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="from-arrays-to-streams-and-back"><a href="#from-arrays-to-streams-and-back" class="header-anchor">#</a> From Arrays to Streams and Back</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fruits <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Banana&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Melon&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>fruits<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>fruit<span class="token operator">-&gt;</span>fruit<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="parallel-data-processing-with-streams"><a href="#parallel-data-processing-with-streams" class="header-anchor">#</a> Parallel Data Processing with Streams</h2> <h2 id="handing-null-with-optionals"><a href="#handing-null-with-optionals" class="header-anchor">#</a> Handing null with Optionals</h2> <h2 id="functional-exception-handling"><a href="#functional-exception-handling" class="header-anchor">#</a> Functional Exception Handling</h2> <p>Not Throwing Exceptions</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">safeReadString</span><span class="token punctuation">(</span><span class="token class-name">Path</span> path<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>use optional instead of exception</p> <h2 id="lazy-evaluation-2"><a href="#lazy-evaluation-2" class="header-anchor">#</a> Lazy Evaluation</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Function</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Supplier</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> holder<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Thunk</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>holder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>supplier <span class="token keyword">instanceof</span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> supplier<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>supplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// multi thread</span>
    <span class="token keyword">private</span> <span class="token keyword">synchronized</span> <span class="token class-name">T</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>holder <span class="token keyword">instanceof</span> <span class="token class-name">Holder</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> evaluated <span class="token operator">=</span> supplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Holder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>evaluated<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>holder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Thunk</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Thunk</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// cache the result</span>
    <span class="token keyword">private</span> <span class="token keyword">record</span> <span class="token class-name">Holder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre></div><h2 id="asynchronous-tasks"><a href="#asynchronous-tasks" class="header-anchor">#</a> Asynchronous Tasks</h2> <p>CompletableFuture</p> <h2 id="functional-design-patterns"><a href="#functional-design-patterns" class="header-anchor">#</a> Functional Design Patterns</h2> <h3 id="factory-pattern"><a href="#factory-pattern" class="header-anchor">#</a> Factory Pattern</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">corners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Color</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ShapeType</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>
    RED<span class="token punctuation">,</span>
    GREEN<span class="token punctuation">,</span>
    BLUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token class-name">Color</span> color<span class="token punctuation">)</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">corners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ShapeType</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ShapeType</span><span class="token punctuation">.</span>CIRCLE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// factory 和 enum 合并起来</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ShapeType</span> <span class="token punctuation">{</span>
    <span class="token function">CIRCLE</span><span class="token punctuation">(</span><span class="token class-name">Circle</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">TRIANGLE</span><span class="token punctuation">(</span><span class="token class-name">Triangle</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Color</span><span class="token punctuation">,</span><span class="token class-name">Shape</span><span class="token punctuation">&gt;</span></span> factory<span class="token punctuation">;</span>
    <span class="token class-name">ShapeType</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Color</span><span class="token punctuation">,</span><span class="token class-name">Shape</span><span class="token punctuation">&gt;</span></span> factory<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>factory <span class="token operator">=</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Shape</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Color</span> color<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>factory<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>传统的 factory 模式会单独写一个类 ShapeFactory 并提供一个静态方法 作为工厂方法，在这个方法中会根据 传入的 ShapeType 创建实例。但是每次枚举一扩展就要扩展这个 ShapeFacotry方法，可能会造成遗漏。 上面代码把枚举和工厂合二为一，避免这个问题。</p> <p>high cohesion</p> <h3 id="decorator-pattern"><a href="#decorator-pattern" class="header-anchor">#</a> Decorator Pattern</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CoffeeMaker</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getIngredients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Coffee</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlackCoffeeMaker</span> <span class="token keyword">implements</span> <span class="token class-name">CoffeeMaker</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getIngredients</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Robusta Beans&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Water&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BlackCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>我们有一个 interface CoffeeMaker , 它可以有很多的具体实现class，例如上面的 BlackCoffeeMaker。我们要对CoffeeMaker装饰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Decorator</span> <span class="token keyword">implements</span> <span class="token class-name">CoffeeMaker</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CoffeeMaker</span> target<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Decorator</span><span class="token punctuation">(</span><span class="token class-name">CoffeeMaker</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getIngredients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getIngredients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddMilkDecorator</span> <span class="token keyword">extends</span> <span class="token class-name">Decorator</span><span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token class-name">AddMilkDecorator</span><span class="token punctuation">(</span><span class="token class-name">CoffeeMaker</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getIngredients</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> ingredients <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getIngredients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ingredients<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Milk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ingredients<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;add milk prepare&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 decorator 要这样</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">CoffeeMaker</span> maker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AddMilkDecorator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlackCoffeeMaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以使用多个decorator，上面的语句就会有很多嵌套。</p> <p>functional的方式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Barista</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Barista</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CoffeeMaker</span> <span class="token function">decorate</span><span class="token punctuation">(</span><span class="token class-name">CoffeeMaker</span> coffeeMaker<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CoffeeMaker</span><span class="token punctuation">,</span><span class="token class-name">CoffeeMaker</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> decorators<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 多个decorator一起使用， decorator这里就是 CofferMaker -&gt; CoffeeMaker</span>
        <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CoffeeMaker</span><span class="token punctuation">,</span><span class="token class-name">CoffeeMaker</span><span class="token punctuation">&gt;</span></span> reducedDecorators <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>decorators<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Function</span><span class="token operator">::</span><span class="token function">andThen</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> reducedDecorators<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coffeeMaker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里 decorator 的创建也可以借助 静态函数</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CoffeeMaker</span><span class="token punctuation">,</span><span class="token class-name">CoffeeMaker</span><span class="token punctuation">&gt;</span></span> <span class="token function">addMilk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">AddMilkDecorator</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数式写法可以减少显式代码嵌套(一层层装饰器)，避免暴露具体的类型 (AddMilkDecorator 可以设为package level， 通过 静态方法使用 )</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notebook/advanced-react/" class="prev">
        Advanced React
      </a></span> <span class="next"><a href="/notebook/functional-programming-in-java-bookshelf/">
        Functional Programming in Java
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook/assets/js/app.144afc9d.js" defer></script><script src="/notebook/assets/js/2.488a9fea.js" defer></script><script src="/notebook/assets/js/49.ae90d64e.js" defer></script>
  </body>
</html>
